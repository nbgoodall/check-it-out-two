<script>
  import { store, project } from 'store'

  import tools from 'tools'

  function addColor(evt) {
    let color = evt.target.value.toUpperCase()

    // Gif export pure black fix; hacky AF I know.
    if (color === '#000000') {
      color = '#00000F'
    }

    $project.addColor(color)
  }

  $: tool = tools[$store.tool]
</script>

<div class="flex flex-col items-end">
  <div class="flex flex-row items-start">
    <div class="overflow-x-scroll overflow-y-hidden max-w-sm flex flex-row-reverse pb-4">
      <div class="border-2 flex items-center flex-row-reverse px-px py-px">

        {#each $project.colors as color }
          <div class="relative flex-shrink-0 w-6 h-6 mx-px" style="background-color: { color };" on:click|stopPropagation={ () => $project.color = color }>

            {#if color == 'transparent' }
              <img src="/images/grid/mini_transparent.svg" class="absolute inset-0" alt="Transparent checkered grid.">
            {/if}

          </div>
        {/each}

      </div>
    </div>

    <div class="relative w-8 h-8 border-2 border-white ml-2 shadow-md">
      <input
        type="color"
        class="absolute inset-0 block w-full h-full appearance-none focus:outline-none"
        value={ $project.color == 'transparent' ? '#FFFFFF' : $project.color }
        on:change={ addColor }
      />

      {#if $project.color == 'transparent' }
        <img src="/images/grid/mini_transparent.svg" class="absolute inset-0" alt="Transparent checkered grid.">
      {/if}
    </div>
  </div>

<!--   <button class="bg-white h-8 w-8 mt-3 focus:outline-none flex justify-center items-center border-2 border-green-400">
    <svg class="fill-current text-gray-800 w-5 h-5" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
      <path  d="M10.8601685,11.9953299l2.5251465,6.0802317L11.1703491,19l-2.5252075-6.050354L5,16.6248779V1.1005249l10.9461327,10.8882742L10.8601685,11.9953299z"/>
    </svg>
  </button> -->

  <!-- Pointer -->

  <button on:click|stopPropagation={ () => $store.tool = 'pointer' } class="bg-white h-8 w-8 mt-3 focus:outline-none flex justify-center items-center border-2 text-gray-900 { tool.name == 'pointer' && 'border-green-400' }">
    <svg class="fill-current w-5 h-5 { tool.name != 'pointer' && 'opacity-50' }" viewBox="0 0 100 160" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0H20V20H40V40H60V60H80V80H100V100H60V120H80V160H60V140H40V120H20V140H0V0Z" fill="black"/>
    </svg>
  </button>


  <!-- Brush -->
  <button on:click|stopPropagation={ () => $store.tool = 'brush' } class="bg-white h-8 w-8 mt-3 focus:outline-none flex justify-center items-center border-2 text-gray-900 { tool.name == 'brush' && 'border-green-400' }">
    <svg class="fill-current w-5 h-5 { tool.name != 'brush' && 'opacity-50' }" viewBox="0 0 140 140" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M120 0H140V20H120V0Z" />
      <path d="M100 20H120V40H100V20Z" />
      <path d="M80 40H100V60H80V40Z" />
      <path d="M60 60H80V80H60V60Z" />
      <path d="M40 80H60V100H40V80Z" />
      <path d="M0 100H40V140H20V120H0V100Z" />
      <path d="M0 120H20V140H0V120Z" fill="{ $project.color }" />
    </svg>

  </button>

  <!-- Rectangle -->
  <button on:click|stopPropagation={ () => $store.tool = 'rectangle' } class="bg-white h-8 w-8 mt-2 focus:outline-none flex justify-center items-center border-2 text-gray-900 { tool.name == 'rectangle' && 'border-green-400' }">
    <svg class="fill-current w-5 h-5 { tool.name != 'rectangle' && 'opacity-50' }" viewBox="0 0 140 140" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0H140V140H0V0ZM20 20V120H120V20H20Z" fill="{ $project.color }" />
    </svg>
  </button>

  <!-- Fill -->

  <button on:click|stopPropagation={ () => $store.tool = 'fill' } class="bg-white h-8 w-8 mt-2 focus:outline-none flex justify-center items-center border-2 text-gray-900 { tool.name == 'fill' && 'border-green-400 text-gray-900' }">
    <svg class="fill-current w-5 h-5 { tool.name != 'fill' && 'opacity-50' }" viewBox="0 0 180 160" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M80 0H100V20H120V40H140V100H100V80H180V120H160V140H140V160H100V140H80V120H60V100H40V80H20V60H40V40H60V20H80V0Z" />
      <path d="M20 20H60V40H40V60H20V120H0V40H20V20Z" fill={ $project.color } />
      <path d="M120 20H160V40H120V20Z" fill="#D8D8D8"/>
      <path d="M160 40H180V60H160V40Z" fill="#ACACAC"/>
      <path d="M140 60H160V80H140V60Z" fill="#ACACAC"/>
      <path d="M100 80H140V100H100V80Z" fill="#ACACAC"/>
    </svg>



  </button>

  <!-- Line -->

  <button on:click|stopPropagation={ () => $store.tool = 'line' } class="bg-white h-8 w-8 mt-2 focus:outline-none flex justify-center items-center border-2 text-gray-500 { tool.name == 'line' && 'border-green-400 text-gray-900' }">
   <svg class="fill-current w-5 h-5" viewBox="0 0 140 140" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M140 0H120V20H140V0Z" />
      <path d="M120 20H100V40H120V20Z" />
      <path d="M100 40H80V60H100V40Z" />
      <path d="M80 60H60V80H80V60Z" />
      <path d="M60 80H40V100H60V80Z" />
      <path d="M40 100H20V120H40V100Z" />
      <path d="M20 120H0V140H20V120Z" />
    </svg>
  </button>

  <!-- Ellipse -->

  <button on:click|stopPropagation={ () => $store.tool = 'ellipse' } class="bg-white h-8 w-8 mt-2 focus:outline-none flex justify-center items-center border-2 text-gray-500 { tool.name == 'ellipse' && 'border-green-400 text-gray-900' }">
   <svg class="fill-current w-5 h-5" viewBox="0 0 140 140" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M60 0H40V20H60V0Z" />
      <path d="M80 0H60V20H80V0Z" />
      <path d="M100 0H80V20H100V0Z" />
      <path d="M40 20H20V40H40V20Z" />
      <path d="M120 20H100V40H120V20Z" />
      <path d="M20 40H0V60H20V40Z" />
      <path d="M140 40H120V60H140V40Z" />
      <path d="M20 60H0V80H20V60Z" />
      <path d="M140 60H120V80H140V60Z" />
      <path d="M20 80H0V100H20V80Z" />
      <path d="M140 80H120V100H140V80Z" />
      <path d="M40 100H20V120H40V100Z" />
      <path d="M120 100H100V120H120V100Z" />
      <path d="M60 120H40V140H60V120Z" />
      <path d="M80 120H60V140H80V120Z" />
      <path d="M100 120H80V140H100V120Z" />
    </svg>
  </button>
</div>