<script>
  import { project } from 'store'

  let gifPromise = null,
      gifProgress = 0

  $: transparent = $project.transparent

  function exportSvg() {
    return $project.exportSvg()
  }

  function exportGif() {
    gifPromise = $project.exportGif(progress => gifProgress = progress)
  }
</script>

<div class="bg-white w-full max-h-full max-w-xl p-8 pointer-events-auto">
  <p class="tracking-wide text-gray-700 font-light text-base">Background</p>

  <div class="flex bg-gray-100 p-3 mt-px">
    <div class="flex flex-col">
      <small class="leading-none uppercase text-gray-600 text-xs">Color</small>

      <input
        type="color"
        disabled={ transparent }
        class="appearance-none w-8 h-8 border-2 border-white shadow-md focus:outline-none mt-2 { transparent && 'opacity-25' }"
        bind:value={ $project.backgroundColor }
      />
    </div>

    <div class="flex flex-col ml-6 justify-between">
      <small class="leading-none uppercase text-gray-600 text-xs">Transparent</small>

      <button
        on:click={ () => $project.transparent = !transparent }
        class="focus:outline-none border-2 border-gray-500 text-sm w-8 h-8 flex items-center justify-center mt-2 { transparent && 'bg-blue-600 border-blue-600' }"
      >
      {#if transparent }
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="w-5 h-5 fill-current text-white"><path d="M0 11l2-2 5 5L18 3l2 2L7 18z"/></svg>
      {/if}
    </button>
    </div>
  </div>

  <p class="tracking-wide text-gray-700 font-light text-base mt-3">GIF Settings</p>

  <div class="flex bg-gray-100 p-3 mt-px">
    <div class="flex flex-col">
      <small class="leading-none uppercase text-gray-600 text-xs">Infinite Loop</small>

      <button
        on:click={ () => $project.infiniteGif = !$project.infiniteGif }
        class="focus:outline-none border-2 border-gray-500 text-sm w-8 h-8 flex items-center justify-center mt-2 { $project.infiniteGif && 'bg-blue-600 border-blue-600' }"
      >
      {#if $project.infiniteGif }
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="w-5 h-5 fill-current text-white"><path d="M0 11l2-2 5 5L18 3l2 2L7 18z"/></svg>
      {/if}
    </button>
    </div>
  </div>

  <div class="flex -mx-1 mt-3">
    <button on:click={ exportSvg } class="flex-1 focus:outline-none bg-green-500 text-white px-3 py-2 text-xl leading-none mx-1">Export SVG</button>

    <button
      on:click={ exportGif }
      class="relative flex-1 focus:outline-none bg-pink-600 text-white px-3 py-2 text-xl leading-none mx-1 flex items-center justify-center"
    >
      {#await gifPromise }
        <div class="absolute inset-0 bg-pink-900 z-0" style="width: { 100 * gifProgress }%;" />
        <div class="z-10">Exporting&hellip;</div>
      {:then }
        Export GIF
      {/await}
    </button>
  </div>
</div>