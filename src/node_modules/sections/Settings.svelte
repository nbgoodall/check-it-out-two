<script>
  import { Overlay } from 'components'
  import Export from './Export.svelte'
  import Projects from './Projects.svelte'

  import { CANVAS_SIZE } from 'config/constants'

  import { project, history } from 'store'

  import { History } from 'history'

  $: canUndo = $history.index >= 0
  $: canRedo = $history.index < ($history.timeline.length - 1)

  let exportVisible = false,
    projectsVisible = false

  $: invalidTitle = $project.title.length == 0

  const keydown = evt => {
    // Escape key
    if (evt.keyCode === 27) {
      exportVisible = false
      projectsVisible = false
    }
  }
</script>

<svelte:window on:keydown={ keydown } />

<div class="flex justify-end" style="max-width: { CANVAS_SIZE }px;">

  <input
    bind:value={ $project.title } required
    class="w-full bg-transparent focus:outline-none focus:border-gray-500 border px-1 { invalidTitle && 'border-red-400 focus:border-red-600' }"
  >

  <button
    on:click|stopPropagation={ () => projectsVisible = true }
    class="focus:outline-none p-1 border-2 bg-teal-200 border-teal-200 text-sm ml-3"
  >
    <svg class="w-5 h-5 fill-current text-teal-900" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
      <path d="M0 4c0-1.1.9-2 2-2h7l2 2h7a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2 2v10h16V6H2z"/>
    </svg>
  </button>

  <button
    disabled={ !canUndo }
    on:click|stopPropagation={ History.undo }
    class="focus:outline-none p-1 bg-gray-400 border-gray-200 text-sm ml-3 disabled:opacity-50"
  >
    <svg class="fill-current text-gray-800 w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
      <path d="M7.05 9.293L6.343 10 12 15.657l1.414-1.414L9.172 10l4.242-4.243L12 4.343z"/>
    </svg>
  </button>

  <button
    disabled={ !canRedo }
    on:click|stopPropagation={ History.redo }
    class="focus:outline-none p-1 bg-gray-400 border-gray-200 text-sm ml-1 disabled:opacity-50"
  >
    <svg class="fill-current text-gray-800 w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
      <path d="M12.95 10.707l.707-.707L8 4.343 6.586 5.757 10.828 10l-4.242 4.243L8 15.657l4.95-4.95z"/>
    </svg>
  </button>

  <button
    on:click|stopPropagation={ () => $project.showGrid = !$project.showGrid }
    class="focus:outline-none border-2 p-1 border-gray-400 text-sm ml-3 { $project.showGrid && 'bg-gray-400' }"
  >
    <svg class="stroke-current text-gray-500 w-5 h-5 { $project.showGrid && 'text-gray-800' }" viewBox="0 0 110 110" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M5 38.5H105M5 71.5H105M72.8571 5V105M39.1837 5V105M5 5H105V105H5L5 5Z" stroke-width="10"/>
    </svg>
  </button>

  <button
    on:click|stopPropagation={ () => $project.showUnderlay = !$project.showUnderlay }
    class="focus:outline-none border-2 border-gray-600 px-2 text-sm ml-3 leading-none { $project.showUnderlay && 'bg-teal-500 text-white border-teal-500' }"
  >
    Underlay
  </button>

  <button disabled={ invalidTitle } on:click={ () => exportVisible = true } class="focus:outline-none bg-purple-600 text-white px-3 py-1 text-sm ml-3 leading-none  { invalidTitle && 'opacity-50' }">Export</button>

</div>

<Overlay bind:visible={ exportVisible } >
  <Export />
</Overlay>

<Overlay bind:visible={ projectsVisible } >
  <Projects bind:visible={ projectsVisible } />
</Overlay>




