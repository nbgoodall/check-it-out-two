<script>
  import { SortableList } from 'components'

  import { project } from 'store'

  $: layers = $project.currentFrame.layers//.reverse()

  function newLayer() {
    $project.currentFrame.addLayer()

    return $project.update()
  }

  function selectLayer(index) {
    $project.currentFrame.layerIndex = index

    return $project.update()
  }

  function sortLayers(evt) {
    const { oldIndex, newIndex } = evt.detail

    $project.currentFrame.sortLayers(oldIndex, newIndex)

    return $project.update()
  }
</script>

<div class="relative max-w-full w-56 h-full overflow-scroll border-2 mt-2">
  <div class="absolute inset-0">
    <div class="bg-green-600 px-3 py-2 m-1 cursor-pointer" on:click={ newLayer }>
      <p class="text-white">New Layer</p>
    </div>

    <SortableList
      key='id'
      list={ layers }
      on:sort={ sortLayers }
      let:item
      let:index
    >
      <div
        class="bg-gray-100 px-3 py-2 m-1 border-2 cursor-move { $project.currentFrame.layerIndex == index && 'border-green-500' }"
        on:mousedown={ () => selectLayer(index) }
      >
        <p>Layer { item.id + 1 }</p>
      </div>
    </SortableList>
  </div>
</div>