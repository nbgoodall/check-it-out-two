<script>
  import { Project } from 'components'

  import {
    projects,
    createProject,
    deleteProject,
    setCurrentProject,
  } from 'store'

  export let visible;

  const projectSort = (a, b) => b.id - a.id

  $: sortedProjects = Object.values($projects).sort(projectSort)

  function _createProject() {
    visible = false

    return createProject()
  }

  function _setProject(id) {
    visible = false

    return setCurrentProject(id)
  }

  const _deleteProject = id => event => {
    event.stopPropagation()

    let confirmText = `Are you sure? ${ $projects[id].title } shall vanish from existence.`

    if (confirm(confirmText)) {
      deleteProject(id)

      return true
    }

    return false
  }
</script>

<div class="flex justify-between">
  <h1 class="text-2xl text-gray-700">Projects</h1>

  <button on:click={ _createProject } class="focus:outline-none bg-green-600 text-white px-3 py-1 text-sm ml-3 leading-none">New Project</button>
</div>

{#each sortedProjects as project }
  <Project
    bind:project
    setProject={ () => _setProject(project.id) }
    deleteProject={ _deleteProject(project.id) }
  />
{/each}
