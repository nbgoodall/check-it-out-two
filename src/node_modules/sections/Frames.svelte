<script>
  import { SortableList } from 'components'

  import { project, store } from 'store'

  function sortFrames(evt) {
    const { oldIndex, newIndex } = evt.detail

    $project.sortFrames(oldIndex, newIndex)
  }
</script>

<div class="w-full max-w-3xl select-none">
  <SortableList
    className="flex flex-wrap { $project.frames.length <= 10 && 'justify-center' }"
    key={ null }
    list={ $project.frameIds }
    on:sort={ sortFrames }
    let:item={ id }
    let:index
  >
    <div
      on:mousedown={ () => ($store.activeFrameIds = [id]) && $project.update() }
      class="relative m-1 w-16 h-16 bg-white border-2 border-gray-400 { $store.activeFrameIds.includes(id) && 'border-green-400' }"
    >
      {#if $project.frames[id].repeat > 1 }
        <div
          class="absolute top-0 right-0 px-1 rounded-full bg-white border flex items-center justify-center shadow-md"
          style="min-height: 20px; min-width: 20px; margin-top: -10px; margin-right: -10px;"
        >
          <span class="text-xs text-gray-800">{ $project.frames[id].repeat }</span>
        </div>
      {/if}

      <img src={ $project.frames[id].image.src } class="h-full w-full pointer-events-none" alt="frame-{ 'hs' }">
    </div>
  </SortableList>
</div>