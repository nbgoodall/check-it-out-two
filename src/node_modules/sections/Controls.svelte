<script>
  import { project, store } from 'store'

  let animationId = null


  function play() {
    animationId = setTimeout(() => {
      const index = $project.frameIds.indexOf(store.get('activeFrameIds')[0])

      $store.activeFrameIds = [ $project.frameIds[(index + 1) % $project.frameIds.length] ]

      requestAnimationFrame(play)
    }, $project.currentFrame.repeat * 1000 / $project.frameRate)
  }

  // Sometimes fails.. TODO: fix bug
  function pause() {
    clearTimeout(animationId)

    animationId = null
  }

</script>

<div class="flex justify-center">
  <button class="focus:outline-none bg-green-600 text-white px-3 py-1 text-sm" on:click|stopPropagation={ () => animationId ? pause() : play() }>
    { animationId ? 'Pause' : 'Play' }
  </button>
</div>