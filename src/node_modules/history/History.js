import { get } from 'svelte/store'

import * as commands from 'commands'

import { history, project } from 'store'

const perform = method => {
  const { index, timeline } = get(history)

  if (method === 'undo' && index < 0 ||
      method === 'redo' && index >= (timeline.length - 1))
    return false

  const { name, state } = timeline[method === 'undo' ? index : index + 1]

  commands[name][method](state)

  history.update({ index: index + (method === 'undo' ? -1 : 1) })

  get(project).update()
}

class History {
  static undo() {
    return perform('undo')
  }

  static redo() {
    return perform('redo')
  }
}

export default History