import { DEFAULT_COLORS } from 'config/constants'

import GIF from 'gif.js.optimized'

function createLink(url, title) {
  const a = document.createElement('a')

  a.style.display = 'none'
  a.href = url
  a.download = title.replace(/ /g, '_') + '.gif'

  document.body.appendChild(a)
  a.click()
  document.body.removeChild(a)

  return window.URL.revokeObjectURL(url)
}

function createGif(frames, title, width, height) {
  let gif = new GIF({
    workers: 2,
    quality: 10,
    width,
    height,
    background: DEFAULT_COLORS.white
  })

  frames.forEach(frame => gif.addFrame(...frame))

  gif.on('finished', function(blob) {
    // For testing, this opens the image in a new tab which is super duper wuper handy
    // return window.open(URL.createObjectURL(blob))

    const url = window.URL.createObjectURL(blob)

    return createLink(url, title)
  })

  gif.render()
}

export default createGif