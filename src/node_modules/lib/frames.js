import {
  RESOLUTION,
  PIXEL_SIZE,
  DEFAULT_COLORS
} from 'config/constants'

import { createCanvasImage } from 'lib/createCanvasImageAsync'

const SIZE = PIXEL_SIZE * RESOLUTION

function createBlankImage(color = DEFAULT_COLORS.white) {
  return createCanvasImage(ctx => {
    ctx.fillStyle = color
    ctx.fillRect(0, 0, SIZE, SIZE)
  })
}

function render(ctx, pixels, backgroundColor = null) {
  ctx.clearRect(0, 0, SIZE, SIZE)

  if (backgroundColor) {
    ctx.fillStyle = backgroundColor
    ctx.fillRect(0, 0, SIZE, SIZE)
  }

  for (let [y, row] of pixels.entries()) {
    for (let [x, color] of row.entries()) {
      ctx.fillStyle = color

      ctx.fillRect(x * PIXEL_SIZE, y * PIXEL_SIZE, PIXEL_SIZE, PIXEL_SIZE);
    }
  }
}

function createImage(pixels, backgroundColor) {
  let canvas = document.createElement('canvas')

  canvas.width  = SIZE
  canvas.height = SIZE

  let ctx = canvas.getContext('2d')

  render(ctx, pixels, backgroundColor)

  return canvas.toDataURL()
}

export { createBlankImage, render, createImage }