import {
  RESOLUTION
} from 'config/constants'

import Tool from './Tool'

import { get } from 'svelte/store'

import { project } from 'store'

import { getPixelPositions } from 'lib'

class Brush extends Tool {
  constructor() {
    super()

    this.selecting = false

    this.name = 'brush'
  }

  draw(evt) {
    const { x, y } = getPixelPositions(evt)

    const proj = get(project)

    let color = proj.currentFrame.getPixel(x, y) === proj.color ? null : proj.color

    let newColor = this.selecting ? this.selectingColor : color

    if (!this.selecting) {
      this.selecting = true

      this.selectingColor = color
    }

    proj.currentFrame.setPixel(x, y, newColor)
  }

  mouseDown(evt) {
    return this.draw(evt)
  }

  mouseMove(evt) {
    const isMouseDown = evt.buttons == 1

    if (!isMouseDown) { return false }

    return this.draw(evt)
  }

  mouseUp(evt) {
    this.selecting = false
  }
}

// Mad instance life
export default new Brush()