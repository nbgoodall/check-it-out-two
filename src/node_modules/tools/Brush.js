import { getPixelPosition } from 'lib'

import Tool from './Tool'

class Brush extends Tool {
  constructor() {
    super()

    this.selectingColor = null
  }

  draw(evt) {
    const x = getPixelPosition(evt.offsetX),
          y = getPixelPosition(evt.offsetY)

    let newColor = this.project.currentFrame.pixels[y][x] === this.project.color ? 'transparent' : this.project.color

    if (!this.selectingColor) {
      this.selectingColor = newColor
    }

    this.project.currentFrame.updatePixel(y, x, this.selectingColor || newColor)
  }

  mouseDown(evt) {
    return this.draw(evt)
  }

  mouseMove(evt) {
    const isMouseDown = evt.buttons == 1

    if (!isMouseDown) { return false }

    return this.draw(evt)
  }

  mouseUp(evt) {
    this.selectingColor = null
  }
}

// Mad instance life
export default new Brush()